# Instacopy

## Описание проекта

Данный pet-project представляет собой фотоблог с Instagram-подобным функционалом, реализованным с помощью Django.
Проект состоит из двух приложений: приложения, реализующего основной функционал блога, и приложения для работы с пользовательской аутентификацией.

## Состояние проекта

### На данный момент в проекте:

в приложении accounts
- созданы следующие модели:
    - расширена базовая модель пользователя django.contrib.auth.User;
    - модель пользовательского профиля Profile
- добавлена возможность самостоятельно редактировать настройки своего профиля;
- c помощью библиотеки django-allauth реализованы следующие сценарии аутентификации пользователя:
    - регистрация;
    - login;
    - logout;
    - восстановление пароля с помощью email;

в приложении blog
- созданы следующие модели:
    - пост Post;
    - тэг поста Tag;
    - пользовательская лента Feed;
    - лайк Like (c помощью встроенного в Django фреймворка contenttypes);
    - подписка Follow;
- реализованы сценарии для отображения блога пользователя, пользовательской ленты, детального вида поста, а также для списка постов,
 содержащих одинаковый тэг;
- реализованы сценарии пользовательских подписок, лайков и сохранения постов (c применением технологии AJAX);
- произведена обработка пользовательского доступа внутри представлений и шаблонов;

А также помощью системы сигналов реализованы следующие сценарии:
- при создании нового пользователя в БД создаются объекты пользовательского профиля, ленты и самоподписки для 
автоматического добавления собственных постов в ленту);
- при создании поста происходит парсинг тэгов из текста поста и создаются соответствующие им экземпляры моделей;
- при создании поста происходит автоматическое добавление поста в ленту фолловеров;
- при добавление / удалении подписки происходит автоматическое добавление / удаление постов из ленты фолловера;

Помимо этого в проекте:
- развернуто Docker-окружение с PostgreSQL внутри;
- создана пользовательская manage.py-команда для создания тестовых экземпляров моделей приложений и заполнения ими 
пустых таблиц БД;
- произведена оптимизация запросов к базе внутри кода;


### TODO:

1. Реализовать следующий функционал:
    - удаление постов;
    - создание, редактирование и удаление комментариев;
    - вывод сохраненных постов внутри блога с помощью AJAX-запроса;
    - создание пагинации с помощью AJAX;
    - создание миниатюр файлов при загрузке постов;
    - возможность загрузки более чем одного вложения поста;
    - возможность загрузки и воспроизведения видео в качестве вложения поста;
    - обработка отложенных задач с помощью Celery;

2. Покрыть написанный код тестами;

## Установка, настройка и запуск проекта
- Создайте локально пустую директорию и инициализируйте в ней git-репозиторий:
```bash
mkdir instacopy
cd instacopy
git init
```
- Скопируйте репозиторий проекта в созданную директорию:
```bash
https://github.com/romannovikov/instacopy-petproject.git
```
- Настройте и запустите проект с помощью docker-compose:
```bash
# сборка Docker-сервиса
docker-compose build
# создание исходных таблиц в БД
docker-compose run --rm app python manage.py migrate
# создание тестовых моделей и заполнение таблиц тестовыми данными
docker-compose run --rm app python manage.py createinitialdata
# запуск Docker-сервиса
docker-compose up
```
- В командной строке браузера перейдите по адресу http://0.0.0.0:8000/

При возникновении ошибки "error checking context: 'can't stat '[local path]/data/pgdata''.
ERROR: Service 'app' failed to build : Build failed" при сборке Docker-образа необходимо запустить все 
вышеописанные команды c правами суперпользователя. Это связано с тем, что docker-compose, в зависимости от своих настроек, может создать папку
с БД от имени суперпользователя.

## Используемый стэк технологий

- Python >= 3.8
- Poetry = 0.1.0
- Django = 3.1.5
- PostgreSQL = 13.3
- Docker = 20.10
- HTML5, CSS3, Javascript, JQuery, AJAX


## Структура проекта

    ├── instacopy             <- Корневая директория проекта
    │   ├── manage.py         <- Файл для запуска Django-проекта
    │   ├── apps              <- Директория с приложениями проекта
    │   │   ├── accounts      <- Приложение, реализующее функционал для работы с пользователем
    │   │   └── blog          <- Основное приложение проекта, реализующее функционал блога
    │   ├── config            <- Директория с файлами конфигурации всего проекта
    │   ├── media             <- Директория для хранения загружаемых медиафайлов
    │   │   └── users
    │   ├── static            <- Директория со статическими файлами
    │   └── templates         <- Директория с шаблонами страниц
    │       ├── accounts
    │       └── blog
    ├── Dockerfile            <- Скрипт, автоматизирующий процесс построения Docker-контейнера данного приложения
    ├── docker-compose.yml    <- Скрипт, автоматизирующий процесс управления несколькими Docker-контейнерами (Приложение + PostgreSQL)
    ├── poetry.lock          
    ├── pyproject.toml        <- Файл, созданный Poetry, необходимый для контроля зависимостей проекта
    ├── LICENSE
    └── README.md             <- Файл README с описанием данного проекта.
